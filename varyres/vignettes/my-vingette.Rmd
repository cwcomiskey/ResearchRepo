---
title: "Variable-resolution Heat Maps"
author: "Chris Comiskey"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Variable-resolution Heat Maps}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Imagine you have a great spatial dataset with observations on some response across a continuous domain, and you want to make a heat map. However, the density of these observations varies, sometimes dramatically, across this domain. As a result, you're having trouble choosing a resolution. Not only that, you wish you could convey this varying density in the same heat map Variable-resolution heat maps are just what the doctor ordered! They allow you to integrate region appropriate resolutions, and simultaneously convey the relative data densities in those regions. 

The `varyres(...)` function in this package automates variable-resolution map creation. This vignette will introduce a motivating dataset, then walk you through how to use `varyres(...)` to create the variable-resolution heat map of your dreams.

## Data: `hitter`

To motivate and demonstrate `varyres(...)`, we use `hitter`. The dataset contains `r dim(varyres::hitter)[1]` swings that baseball player Johny Peralta took between approximately 2008 and 2015. The PITCHf/x data, as it is known, comes from [Sportvision, Inc](http://www.sportvision.com/) in conjunction with [Major League Baseball Advanced Media](http://www.mlbam.com/).

```{r}
library(varyres)
dim(hitter)
head(hitter)
```

`hitter` contains four columns, or variables, for each swing.

* `px` gives the horizontal location of the pitch as it passes through the strike zone, in feet from the middle of home plate.
* `pz` gives the vertical location of the pitch as it passes through the strike zone, in feet from the ground.
* `hit` is a Bernoulli random variable that equals 1 if the swing resulted in a hit, and 0 otherwise.
* `des` gives a short description of the play.

## Motivation

Let's look at a scatterplot of the data to highlight the resolution selection challenge.

```{r, echo = FALSE}
  library(ggplot2)

  # kzone <- data.frame(x = c(-0.75, -0.75, 0.75, 0.75, -0.75),
  #                     y = c(1.5, 3.5, 3.5, 1.5, 1.5))

  ggplot(hitter, aes(px, pz)) +
    geom_point(size = 0.5, alpha = 1/5) +
    coord_equal() +
    # geom_path(data = kzone, aes(x = x, y = y),
    #          lwd = 1.5, col = "blue", linetype = 2) +
  labs(title = "Peralta Swing Locations",
  x = "Feet from \n Middle of Home Plate",
  y = "Feet Off Ground") +
  theme(plot.title = element_text(hjust = 0.5))
```

Quite obviously the data is quite dense in the middle, but quite sparse toward the margins. Should we do the plot justice in the middle, or the edges?

```{r, echo = FALSE}
  library(ggplot2)
  devtools::load_all()
  names(hitter) <- c("x", "y", "res", "other")
  vr <- varyres(data = hitter, cutoff = 1, max = 7)

ggplot(vr[[3]], aes(x = x, y = y)) +
  with(vr[[3]], geom_tile(aes(fill = statistic), width = width, height = height)) + 
  coord_equal() +
  scale_fill_distiller(palette = "Spectral", guide = guide_legend(title = expression(hat(p)))) +
  geom_text(aes(label = count)) +
  labs(title = "Empirical Success", subtitle = "Johny Peralta", x = "Feet from \n Middle of Home Plate", y = "Feet Off Ground") +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

```

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
